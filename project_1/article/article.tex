\documentclass[
    a4paper, aps, twocolumn, floatfix, superscriptaddress]{revtex4-1}

% It's nice to be able to write your own name
\usepackage[T1]{fontenc}
% Automatic clickable links
\usepackage{hyperref}
% SI-units
\usepackage{siunitx}
% Enhanced math formatting
\usepackage{amsmath}
% Extended math symbols
\usepackage{amssymb}
% Include proof environment
\usepackage{amsthm}
% Import physics package to include bra-ket
\usepackage{physics}
\usepackage{enumerate}
% Import the tensor package for tensors
\usepackage{tensor}
% Include dod and dpd fracs
\usepackage{commath}
% Include font for the identity operator
\usepackage{dsfont}
% Include package for drawing Feynman diagrams
\usepackage{tikz-feynman}
% Include package for typesetting contractions
\usepackage{simpler-wick}
% Include the Feynman-slash
\usepackage{slashed}
% Include Tikz
\usepackage{tikz}


% Macro for latin-letter vectors
\newcommand{\vf}{\mathbf}
% Macro for greek-letter vectors
\newcommand{\vfg}{\boldsymbol}

% Fast macro for real-numbers R
\newcommand{\R}{\mathbb{R}}
% Fast macro for complex-numbers C
\newcommand{\C}{\mathbb{C}}
% Fast macro for polynomial room P
\renewcommand{\P}{\mathbb{P}}
% New command for the identity operator
\newcommand{\1}{\mathds{1}}
% New command for the Lagrangian density
\newcommand{\cL}{\mathcal{L}}
% New command for the Hamiltonian density
\newcommand{\cH}{\mathcal{H}}
% Fast macro for partial differential tensors
\newcommand{\tpl}[1]{\tensor{\partial}{_#1}} % Lower
\newcommand{\tpu}[1]{\tensor{\partial}{^#1}} % Upper
% Fast macro for tensors
\newcommand{\te}[1]{\tensor{#1}}
% Fast macro for commutation and anti-commutation relations
\newcommand{\com}[2]{\left[#1, #2\right]}
\newcommand{\acom}[2]{\left\{#1, #2\right\}}

% Macros for writing auto-sized paranthesis, brackets and braces
\newcommand{\para}[1]{\left(#1\right)}
\newcommand{\brak}[1]{\left[#1\right]}
\newcommand{\brac}[1]{\left\{#1\right\}}

% Macro for creating orbital bra-ket's, i.e., bra-ket with paranthesis edges
\newcommand{\obra}[1]{( #1 \lvert}
\newcommand{\oket}[1]{\rvert #1 )}
\newcommand{\obraket}[2]{( #1 \lvert #2 )}

% Macro for expectation value
\newcommand{\expv}[1]{\langle #1 \rangle}

\newcommand{\half}{\frac{1}{2}}




\begin{document}

\title{Variational Monte Carlo on bosonic systems}
\author{Winther-Larsen, Sebastian Gregorius}
\affiliation{University of Oslo}
\author{Schøyen, Øyvind Sigmundson}
\affiliation{University of Oslo}
\date{\today}

\maketitle

\section{Introduction}
    We will in this project study the Variational Monte Carlo (VMC) method, and
    use it to evaluate the ground state energy of a trapped, hard sphere Bose
    gas.

\section{Theory}
    To model the trapped bosonic gas particles we use the potential
    \begin{align}
        V_{\text{ext}}(\vf{r})
        &=
        \begin{cases}
            \half m\omega^2r^2 & (\text{S}), \\
            \half m \bigl[
                \omega^2(x^2 + y^2) + \omega_z^2z^2
            \bigr] & (\text{E}),
        \end{cases}
    \end{align}
    where we can choose between a spherical (S) or an elliptical (E) harmonic
    trap. The two-body Hamiltonian of the system is given by
    \begin{align}
        H = \sum_{i}^{N}h(\vf{r}_i) + \sum_{i < j}^{N}w(\vf{r}_i, \vf{r}_j),
    \end{align}
    where the single particle one body operator, $h$, is given by
    \begin{align}
        h(\vf{r}_i) = -\frac{\hbar^2}{2m}\nabla_i^2
        + V_{\text{ext}}(\vf{r}_i),
    \end{align}
    (we assume equal mass)
    and the two-body interaction operator, $w$, is
    \begin{align}
        w(\vf{r}_i, \vf{r}_j)
        = \begin{cases}
            \infty & |\vf{r}_i - \vf{r}_j| \leq a, \\
            0 & |\vf{r}_i - \vf{r}_j| > a,
        \end{cases}
    \end{align}
    where $a$ is the hard sphere of the particle. The trial wavefunction we will
    be looking at is given by
    \begin{align}
        \Psi_T(\vf{r})
        &= \bra{\vf{r}}\ket{\Psi_T}
        = \bra{\vf{r}}\ket{\Phi_T}
        \prod_{j < k}^N f(a, \vf{r}_j, \vf{r}_k) \\
        &= \Biggl(
            \prod_i^N g(\alpha, \beta, \vf{r}_i)
        \Biggr)
        \prod_{j < k}^N f(a, \vf{r}_j, \vf{r}_k),
        \label{eq:initial_trial_wavefunction}
    \end{align}
    where $\alpha$ and $\beta$ are variational parameters and
    \begin{align}
        \vf{r} = (\vf{r}_1, \vf{r}_2, \dots, \vf{r}_N, \alpha, \beta).
    \end{align}
    Here $g$ are the single particle wavefunctions given by
    \begin{align}
        g(\alpha, \beta, \vf{r}_i)
        = \exp\bigl[
            -\alpha(x_i^2 + y_i^2 + \beta z_i^2)
        \bigr] \equiv \phi(\vf{r}_i),
    \end{align}
    and $\ket{\Phi_T}$ the \textit{Slater permanent} consisting of the $N$ first
    single particle wavefunctions, and the correlation wavefunction, $f$, given
    by
    \begin{align}
        f(a, \vf{r}_j, \vf{r}_k)
        &=
        \begin{cases}
            0 & |\vf{r}_j - \vf{r}_k| \leq a, \\
            \Bigl(
                1 - \frac{a}{|\vf{r}_j - \vf{r}_k|}
            \Bigr) & |\vf{r}_j - \vf{r}_k| > a.
        \end{cases}
    \end{align}

    \subsection{Local energy}
        As the many-body wavefunction creates a very large configuration space,
        where much of the wavefunction is small, we use the Metropolis algorithm
        in order to move towards regions in configuration space with
        ``sensible'' values. We define the \textit{local energy}, $E_L{\vf{r}}$,
        by
        \begin{align}
            E_L(\vf{r})
            &= \frac{\bra{\vf{r}}H\ket{\Psi_T}}{\bra{\vf{r}}\ket{\Psi_T}}.
        \end{align}
        If $\ket{\Psi_T}$ is an exact eigenfunction of the Hamiltonian, $E_L$
        will be constant. The closer $\ket{\Psi_T}$ is to the exact wave
        function, the less variation in $E_L$ as a function of $\vf{r}$ we get.
        One of the most computationally intensive part of the VMC algorithm will
        be to compute $E_L$. We therefore find an analytical expression for
        $E_L$ in terms of the trial wavefunction.

        \subsubsection{Non-interacting harmonic oscillator}
            We start by finding an analytical expression for the local energy
            with a system where we set $a = 0$ and $\beta = 1$, i.e., a system
            of non-interacting harmonic oscillators.
            \begin{align}
                \bra{\vf{r}}\ket{\Psi_T}
                = \bra{\vf{r}}\ket{\Phi_T}
                = \prod_i^N \exp\bigl[
                    -\alpha |\vf{r}_i|^2
                \bigr],
            \end{align}
            where $|\vf{r}_i| = r_i$. As $a = 0$ the interaction term,
            $w(\vf{r}_i, \vf{r}_j)$, vanishes and the Hamiltonian is given by
            (in the spherical case)
            \begin{align}
                H &= \sum_i^N h(\vf{r}_i)
                = \sum_i^N \biggl(
                    -\frac{\hbar^2}{2m}\nabla_i^2
                    + \half m \omega^2 r_i^2
                \biggr).
            \end{align}
            Working in spherical coordinates the gradient and the Laplace
            operator (applied to a scalar function) becomes
            \begin{align}
                \nabla f
                &= \vf{e}_r\tpl{r}f
                + \vf{e}_{\theta}\frac{1}{r}\tpl{\theta}f
                + \vf{e}_{\phi}\frac{1}{r\sin(\theta)}\tpl{\phi}f, \\
                \nabla^2 f
                &= \frac{1}{r^2}\tpl{r}
                \bigl[
                    r^2\tpl{r}f
                \bigr]
                + \frac{1}{r^2\sin(\theta)}\tpl{\theta}
                \bigl[
                    \sin(\theta)\tpl{\theta}f
                \bigr] \nonumber\\
                &\qquad
                + \frac{1}{r^2\sin^2(\theta)}\tpl{\phi}^2f,
            \end{align}
            where $\vf{e}_r$ signifies the unit vector in the radial direction
            and we use the shorthand notation
            \begin{align}
                \tpl{r}f \equiv \dpd[]{f}{r}.
            \end{align}
            As the trial wavefunction for $\beta = 1$ is purely radial we get
            the same expression in one, two and three dimensions by setting
            \begin{align}
                r^2 =
                \begin{cases}
                    x^2 & \text{one dimension}, \\
                    x^2 + y^2 & \text{two dimensions}, \\
                    x^2 + y^2 + z^2 & \text{three dimensions}.
                \end{cases}
            \end{align}
            The gradient then becomes
            \begin{align}
                \nabla_i\bra{\vf{r}}\ket{\Psi_T}
                &= \vf{e}_{{r_i}}\tpl{{r_i}}\prod_j^N\exp\bigl[
                    -\alpha r_j^2
                \bigr] \\
                &=
                -2\alpha r_i\prod_j^N\exp\bigl[
                    -\alpha r_j^2
                \bigr]\vf{e}_{{r_i}} \\
                &=
                -2\alpha r_i\bra{\vf{r}}\ket{\Psi_T}\vf{e}_{{r_i}}.
            \end{align}
            The Laplacian is given by
            \begin{align}
                \nabla_i^2\bra{\vf{r}}\ket{\Psi_T}
                &= \frac{1}{r_i^2}\tpl{{r_i}}
                \biggl\{
                    r_i^2\tpl{{r_i}}
                    \prod_j^N\exp\bigl[
                        -\alpha r_j^2
                    \bigr]
                \biggr\} \\
                &=
                \frac{1}{r_i^2}\tpl{{r_i}}
                \biggl\{
                    -2 \alpha r_i^3
                    \prod_j^N\exp\bigl[
                        -\alpha r_j^2
                    \bigr]
                \biggr\} \\
                &=
                \frac{1}{r_i^2}
                \Bigl\{
                    -6 \alpha r_i^2
                    + 4\alpha^2 r_i^4
                \Bigr\}
                \prod_j^N\exp\bigl[
                    -\alpha r_j^2
                \bigr]
                \\
                &=
                \Bigl\{
                    -6 \alpha
                    + 4\alpha^2 r_i^2
                \Bigr\}
                \bra{\vf{r}}\ket{\Psi_T}.
            \end{align}
            This gives the analytical expression for the local energy to be
            \begin{align}
                E_L(\vf{r})
                &= \frac{\bra{\vf{r}}H\ket{\Psi_T}}{\bra{\vf{r}}\ket{\Psi_T}} \\
                &= \sum_i^N \Bigl(
                    4\alpha^2 r_i^2
                    + \half m \omega^2 r_i^2
                \Bigr) - 6\alpha.
            \end{align}
            The \textit{drift force} of the system is given by
            \begin{align}
                \vf{F}_i
                &=
                \frac{2\nabla_i\bra{\vf{r}}\ket{\Psi_T}}
                {\bra{\vf{r}}\ket{\Psi_T}} \\
                &= -4\alpha r_i\vf{e}_{{r_i}}.
            \end{align}

        \subsubsection{The full system}
            Moving to the full system allowing $\beta$ to vary and setting $a
            \neq 0$ we write the trial wavefunction as
            \begin{align}
                \bra{\vf{r}}\ket{\Psi_T}
                &=
                \bra{\vf{r}}\ket{\Phi_T}
                J(\vf{r}),
            \end{align}
            where $\ket{\Phi_T}$ is the same Slater permanent as in
            \autoref{eq:initial_trial_wavefunction} and $J(\vf{r})$ is the
            \textit{Jastrow factor} given by
            \begin{align}
                J(\vf{r})
                &=
                \exp\Biggl(
                    \sum_{j < l}^N u(r_{jl})
                \Biggr),
            \end{align}
            where $r_{jk} = |\vf{r}_j - \vf{r}_k|$ and
            \begin{align}
                u(r_{jk}) = \ln\bigl[f(a, \vf{r}_j, \vf{r}_k)\bigr].
            \end{align}
            We wish to find an analytical expression for the local energy.
            Beginning with the gradient we get
            \begin{align}
                \nabla_k\bra{\vf{r}}\ket{\Psi_T}
                &= \nabla_k\Bigl[
                    \bra{\vf{r}}\ket{\Phi_T}
                    J(\vf{r})
                \Bigr] \\
                &=
                \Bigl[
                    \nabla_k
                    \bra{\vf{r}}\ket{\Phi_T}
                \Bigr]
                J(\vf{r})
                + \bra{\vf{r}}\ket{\Phi_T}
                \nabla_k J(\vf{r}).
            \end{align}
            The gradient of the Slater permanent gives
            \begin{align}
                \nabla_k
                \bra{\vf{r}}\ket{\Phi_T}
                &=
                \nabla_k\phi(\vf{r}_k)
                \prod_{i \neq k}^N\phi(\vf{r}_i) \\
                &= \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                \bra{\vf{r}}\ket{\Phi_T}.
            \end{align}
            \begin{widetext}
                The gradient of the Jastrow factor is given by
                \begin{align}
                    \nabla_k J(\vf{r})
                    &=
                    J(\vf{r})
                    \nabla_k\sum_{m < n}^N u(r_{mn}) \\
                    &=
                    J(\vf{r})
                    \Biggl(
                        \sum_{m = 1}^{k - 1}
                        \nabla_k u(r_{mk})
                        +
                        \sum_{n = k + 1}^N
                        \nabla_k u(r_{kn})
                    \Biggr) \\
                    &=
                    J(\vf{r})
                    \sum_{m \neq k}^N\nabla_k u(r_{km}),
                \end{align}
                as $r_{ij} = r_{ji}$.  We are thus left with
                \begin{align}
                    \nabla_k\bra{\vf{r}}\ket{\Psi_T}
                    &=
                    \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                    \bra{\vf{r}}\ket{\Psi_T}
                    + \bra{\vf{r}}\ket{\Psi_T}
                    \sum_{m \neq k}^N\nabla_k u(r_{km}) \\
                    &=
                    \Biggl(
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        +
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)
                    \bra{\vf{r}}\ket{\Psi_T}.
                \end{align}
                We can now find the Laplacian of the trial wavefunction. This
                gives
                \begin{align}
                    \nabla_k^2\bra{\vf{r}}\ket{\Psi_T}
                    &= \nabla_k\nabla_k\bra{\vf{r}}\ket{\Psi_T}
                    = \nabla_k
                    \Biggl(
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        +
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)
                    \bra{\vf{r}}\ket{\Psi_T} \\
                    &=
                    \Biggl(
                        \frac{\nabla_k^2\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        + \left[
                            \nabla\frac{1}{\phi(\vf{r}_k)}
                        \right]
                        \nabla_k\phi(\vf{r}_k)
                        +
                        \sum_{m \neq k}^N\nabla_k^2 u(r_{km})
                    \Biggr)
                    \bra{\vf{r}}\ket{\Psi_T}
                    \\
                    &\qquad
                    +
                    \Biggl(
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        +
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)
                    \nabla_k\bra{\vf{r}}\ket{\Psi_T} \\
                    &=
                    \Biggl(
                        \frac{\nabla_k^2\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        - \left[
                            \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        \right]^2
                        +
                        \sum_{m \neq k}^N\nabla_k^2 u(r_{km})
                    \Biggr)
                    \bra{\vf{r}}\ket{\Psi_T}
                    \\
                    &\qquad
                    +
                    \Biggl(
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        +
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)^2
                    \bra{\vf{r}}\ket{\Psi_T}.
                \end{align}
                We now divide by the trial wavefunction. This simplifies the
                calculations and is more similar to the expression for the local
                energy.
                \begin{align}
                    \frac{\nabla_k^2\bra{\vf{r}}\ket{\Psi_T}}
                    {\bra{\vf{r}}\ket{\Psi_T}}
                    &=
                    \frac{\nabla_k^2\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                    - \left[
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                    \right]^2
                    +
                    \sum_{m \neq k}^N\nabla_k^2 u(r_{km})
                    +
                    \Biggl(
                        \frac{\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                        +
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)^2 \\
                    &=
                    \frac{\nabla_k^2\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                    +
                    \sum_{m \neq k}^N\nabla_k^2 u(r_{km})
                    +
                    \frac{2\nabla_k\phi(\vf{r}_k)}{\phi(\vf{r}_k)}
                    \sum_{m \neq k}^N\nabla_k u(r_{km})
                    +
                    \Biggl(
                        \sum_{m \neq k}^N\nabla_k u(r_{km})
                    \Biggr)^2
                \end{align}
            \end{widetext}
            To go from here we have to find the gradient and the Laplacian of
            the single particle functions, $\phi(\vf{r}_k)$, and the interaction
            functions $u(r_{km})$. For the single particle functions we use
            Cartesian coordinates when finding the derivatives whereas we for
            the interaction functions will use spherical coordinates and do a
            variable substitution. Beginning with the gradient of the single
            particle functions we get
            \begin{align}
                \nabla_k\phi(\vf{r}_k)
                &=
                \nabla_k\exp\bigl[
                    -\alpha(x_k^2 + y_k^2 + \beta z_k^2)
                \bigr] \\
                &=
                -2\alpha
                (x_k\vf{e}_i + y_k\vf{e}_j + \beta z_k\vf{e}_k)
                \phi(\vf{r}_k),
            \end{align}
            note that the subscripts on the unit vectors $\vf{e}_i$ are
            \textit{not} the same as the subscripts used for its components. The
            Laplacian yields
            \begin{align}
                \nabla_k^2\phi(\vf{r}_k)
                &=
                -2\alpha
                \big(
                    2 + \beta
                \bigr)
                \phi(\vf{r}_k)
                \nonumber \\
                &\qquad
                + 4\alpha^2
                \bigl(
                    x_k^2 + y_k^2 + \beta^2z_k^2
                \bigr)
                \phi(\vf{r}_k).
            \end{align}
            In order to derive the interaction functions we have to do a
            variable substitution. We replace the derivative of the radial
            component for particle $k$ by
            \begin{align}
                \tpl{{r_k}}
                = \dpd[]{r_{km}}{r_k}\tpl{{r_{km}}}.
            \end{align}
            The derivative of the distance $r_{km}$ is given by
            \begin{gather}
                r_{km} = |r_k - r_m|
                \implies
                \dpd[]{r_{km}}{r_k}
                = \frac{r_k - r_m}{|r_k - r_m|}.
            \end{gather}
            Working in spherical coordinates we see that $u(r_{km})$ will only
            be a function of radii of particles $k$ and $m$. The gradient thus
            simplifies to the radial contribution giving
            \begin{align}
                \nabla_k u(r_{km})
                &=
                \vf{e}_{r}\tpl{{r_k}}u(r_{km})
                \\
                &=
                \vf{e}_r\dpd[]{r_{km}}{r_k}\tpl{{r_{km}}}u(r_{km})
                \\
                &= \vf{e}_r\frac{r_k - r_m}{r_{km}}
                \tpl{{r_{km}}}u(r_{km}).
            \end{align}
            Using this expression we find the Laplacian to be
            \begin{align}
                \nabla_k^2 u(r_{km})
                &=
                \frac{1}{r_{km}} \tpl{{r_{km}}} u(r_{km})
                \nonumber \\
                &\qquad
                + \frac{(r_k - r_m)^2}{r_{km}^3} \tpl{{r_{km}}} u(r_{km})
                \nonumber \\
                &\qquad
                +
                \frac{r_k - r_m}{r_{km}}\tpl{{r_{km}}}^2 u(r_{km})
            \end{align}


\end{document}
